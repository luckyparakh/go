version: '3.9'
services:
    # OpenTelemetry Collector
    otel_collector:
      image: otel/opentelemetry-collector-contrib:0.70.0
      ports:
        - "4317:4317" # OTLP over gRPC receiver
        - "9464:9464" # Prometheus exporter
      volumes:
        - ./confs/otel-collector-config.yaml:/etc/otel-collector-config.yaml
        - ./confs/server.crt:/etc/tls/server.crt
        - ./confs/server.key:/etc/tls/server.key
        - ./confs/rootCA.crt:/etc/tls/rootCA.crt
      depends_on:
        - jaeger
        - prometheus
      networks:
        - my_net
      command: --config=/etc/otel-collector-config.yaml

    # Jaeger
    jaeger:
      image: jaegertracing/all-in-one:1.41.0
      ports:
        - "14250:14250" # Collector gRPC
        - "16686:16686" # Web HTTP
      networks:
        - my_net

    # Prometheus
    prometheus:
      image: prom/prometheus:v2.40.4
      # command:
      #   - --config.file=/etc/prometheus/prometheus-config.yaml
      volumes:
        - ./confs/prometheus-config.yaml:/etc/prometheus/prometheus-config.yaml
      ports:
        - "9090:9090"
      networks:
        - my_net

networks:
    my_net:    